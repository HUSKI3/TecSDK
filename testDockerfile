FROM docker.io/ubuntu:22.10
LABEL AUTHOR="HUSKI3"

# Source
COPY /src .
# Autogenerated components from the build script
COPY /artifacts .

# Install dependencies for python packages
#
# tree - For debugging folder structure
# Pip  - For installing deps
# Git  - Checking version 
# JDK9 - For PyJnius
# Dbus - For Plyer (Or at least to silence the errors on Docker image)
# LSHW - Not sure what this is required by, assuming plyer
# xdg-user-dirs-gtk - For getting Documents, Pictures and other folders
RUN apt update && apt install --no-install-recommends tree python3-pip openjdk-8-jdk python3-dbus lshw xdg-user-dirs-gtk nano -y

# Cython work-around [https://github.com/h5py/h5py/issues/535]
RUN pip3 install Cython

# Install Python dependencies 
COPY requirements.txt .
RUN --mount=type=cache,target=/root/.cache \
    pip3 install -r requirements.txt

# Install TCore
ADD "https://www.random.org/cgi-bin/randbyte?nbytes=10&format=h" skipcache
RUN python3 tli.py --install-full
RUN chmod +x debug.sh
# XDG dirs patch, docker only
RUN xdg-user-dirs-update


